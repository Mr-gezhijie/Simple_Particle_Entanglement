<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Page Storage</title>
</head>
<body>
  <script>
    // 生成一个唯一的标识符
    function generateUniqueId() {
      return 'id-' + Math.random().toString(36).substr(2, 16);
    }

    // 获取当前标签页的标识符
    let tabId = sessionStorage.getItem('tabId');

    if (!tabId) {
      // 如果当前标签页没有标识符，生成一个并保存到 sessionStorage
      tabId = generateUniqueId();
      sessionStorage.setItem('tabId', tabId);
    }

    // 存储数据到 localStorage，并添加标识符
    function saveData(data) {
      const key = `data-${tabId}`;
      localStorage.setItem(key, JSON.stringify(data));
    }

    // 读取数据
    function loadData() {
      const key = `data-${tabId}`;
      const data = localStorage.getItem(key);
      return data ? JSON.parse(data) : null;
    }

    // 删除当前标签页的数据
    function clearData() {
      const key = `data-${tabId}`;
      localStorage.removeItem(key);
    }

    // 在页面关闭前清除数据
    window.addEventListener('beforeunload', function () {
      clearData();
    });

    // 测试
    saveData({ message: 'Hello from tab ' + tabId });

    // 读取并输出数据
    const loadedData = loadData();
    console.log('Loaded Data:', loadedData);
  </script>
</body>
</html>
